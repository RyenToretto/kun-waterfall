## Context

本项目是一个高性能视频首页，需要在 PC 和移动端均能流畅访问。主要挑战包括：
- 大量视频元素的性能优化
- 瀑布流布局算法
- 视频自动播放与资源管理
- 响应式适配

## Goals / Non-Goals

### Goals
- 实现高性能瀑布流布局，滚动流畅不卡顿
- 视频自动播放视口内内容，离开视口暂停
- 响应式布局适配 PC（1920px）和移动端（375px）
- HTML font-size 固定为 16px
- 支持虚拟滚动，处理大量数据

### Non-Goals
- 不实现用户登录系统
- 不实现视频上传功能
- 不实现评论系统
- 不实现搜索功能（第一期）

## Decisions

### 1. 技术栈选择
- **框架**: Nuxt 4 + Vue 3 Composition API
- **UI 库**: Nuxt UI 4.2.2+
- **样式**: SCSS + CSS Variables（禁止 Tailwind class in template）
- **类型**: TypeScript
- **原因**: 符合项目规范，Nuxt 4 目录结构，组件化开发

### 2. 瀑布流布局方案
- **方案**: CSS Grid + JS 算法控制随机高度
- **原因**: 性能优于纯 JS 定位，支持响应式
- **实现**:
  ```
  - 使用 CSS Grid 创建多列布局
  - JS 计算每个卡片的随机高度比例
  - 视频内容铺满卡片，竖屏截取顶部，横屏截取中间
  ```

### 3. 虚拟滚动方案
- **方案**: 自定义虚拟滚动 composable
- **原因**: 瀑布流高度不固定，需要自定义算法
- **策略**:
  - 维护可见区域上下各 2 屏的缓冲区
  - 使用占位符保持滚动位置
  - 增量渲染避免视觉闪烁

### 4. 视频自动播放方案
- **方案**: IntersectionObserver + 资源池管理
- **原因**: 浏览器原生 API，性能最优
- **策略**:
  - threshold 设置为 0.5（50% 可见时触发）
  - 同时播放视频数量限制（PC: 6, 移动端: 3）
  - 移动端静音自动播放（muted autoplay playsinline）

### 5. 响应式方案
- **方案**: CSS Media Queries + JS useWindowSize
- **断点**:
  - < 640px: 2 列
  - 640-979px: 3 列
  - 980-1199px: 4 列
  - 1200-1459px: 5 列
  - ≥ 1460px: 6 列
- **原因**: 符合设计稿要求，渐进式适配

### 6. Mock 数据方案
- **方案**: Nuxt Server API + JSON 文件
- **原因**: 支持 SSR，易于切换真实 API
- **数据**: 存储 20 页真实数据结构

## Risks / Trade-offs

| 风险 | 缓解措施 |
|------|----------|
| 大量视频导致内存占用高 | 虚拟滚动 + 视频资源回收 |
| 瀑布流高度计算复杂 | 预计算 + 缓存高度数据 |
| 移动端自动播放受限 | 静音播放 + 用户交互后解锁 |
| 首屏渲染时间长 | SSR + 骨架屏 + 懒加载 |

## Migration Plan

N/A - 新项目

## Open Questions

- [ ] 是否需要支持无限滚动加载？（初步：是）
- [ ] 视频封面是否需要预加载？（初步：首屏预加载）
- [ ] 是否需要骨架屏？（初步：是）

